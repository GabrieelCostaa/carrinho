# ğŸ—ï¸ Arquitetura do Sistema

## ğŸ“Š Diagrama de Componentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SISTEMA COMPLETO                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CELULAR    â”‚         â”‚      PC      â”‚         â”‚    ESP32     â”‚
â”‚  (CÃ¢mera)    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Python     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  MicroPython â”‚
â”‚              â”‚  HTTP   â”‚   OpenCV     â”‚WebSocketâ”‚  + Motores   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                         â”‚                         â”‚
      â”‚                         â”‚                         â”‚
      â–¼                         â–¼                         â–¼
   Captura                 Processa                  Move o
   VÃ­deo                   Imagem                   Carrinho
```

## ğŸ”„ Fluxo de Dados

```
1. CAPTURA
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Celular    â”‚ Captura vÃ­deo da linha no chÃ£o
   â”‚  (CÃ¢mera)   â”‚ 
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚ HTTP Stream
          â”‚ (ex: http://192.168.1.101:8080/video)
          â–¼
          
2. PROCESSAMENTO
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                PC - Python                      â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚  â”‚ 1. Recebe frame da cÃ¢mera                â”‚   â”‚
   â”‚  â”‚ 2. Seleciona ROI (regiÃ£o inferior)       â”‚   â”‚
   â”‚  â”‚ 3. Converte BGR â†’ HSV                    â”‚   â”‚
   â”‚  â”‚ 4. Aplica filtro de cor (mÃ¡scara)        â”‚   â”‚
   â”‚  â”‚ 5. Detecta contornos                     â”‚   â”‚
   â”‚  â”‚ 6. Encontra centro da linha              â”‚   â”‚
   â”‚  â”‚ 7. Calcula desvio do centro              â”‚   â”‚
   â”‚  â”‚ 8. Determina velocidades dos motores     â”‚   â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ WebSocket (JSON)
                         â”‚ {"action": "custom", "left": 50, "right": 40}
                         â–¼
                         
3. CONTROLE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚           ESP32 - MicroPython                   â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚  â”‚ 1. Recebe comando via WebSocket          â”‚   â”‚
   â”‚  â”‚ 2. Parse JSON                            â”‚   â”‚
   â”‚  â”‚ 3. Ajusta velocidades dos motores        â”‚   â”‚
   â”‚  â”‚ 4. Controla PWM                          â”‚   â”‚
   â”‚  â”‚ 5. Define direÃ§Ã£o (IN1, IN2, IN3, IN4)   â”‚   â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚              MOTORES DC                         â”‚
   â”‚  Motor Esquerdo          Motor Direito          â”‚
   â”‚       âš™ï¸                      âš™ï¸                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                 CARRINHO SE MOVE! ğŸš—
```

## ğŸ§  Algoritmo de DetecÃ§Ã£o de Linha

```python
def process_frame(frame):
    # 1. SELEÃ‡ÃƒO DE ROI
    #    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    #    â”‚                 â”‚  â† Ignora parte superior
    #    â”‚                 â”‚
    #    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â† ROI comeÃ§a aqui
    #    â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚  â† Foca na parte inferior
    #    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     (onde a linha estÃ¡)
    
    roi = frame[roi_y:height, 0:width]
    
    # 2. CONVERSÃƒO DE COR
    #    BGR â†’ HSV (melhor para detecÃ§Ã£o de cor)
    hsv = cv2.cvtColor(roi, cv2.COLOR_BGR2HSV)
    
    # 3. FILTRAGEM
    #    Cria mÃ¡scara binÃ¡ria (branco = linha, preto = resto)
    mask = cv2.inRange(hsv, lower_black, upper_black)
    
    # 4. LIMPEZA (Morfologia)
    #    Remove ruÃ­dos e preenche buracos
    mask = cv2.erode(mask, kernel)   # Remove ruÃ­do
    mask = cv2.dilate(mask, kernel)  # Preenche buracos
    
    # 5. DETECÃ‡ÃƒO
    #    Encontra contornos (bordas da linha)
    contours = cv2.findContours(mask)
    largest = max(contours, key=cv2.contourArea)
    
    # 6. CENTRO
    #    Calcula centro de massa do contorno
    M = cv2.moments(largest)
    cx = M["m10"] / M["m00"]
    
    # 7. DESVIO
    #    Quanto o centro da linha estÃ¡ do centro da imagem
    deviation = cx - (width // 2)
    
    return deviation
```

## ğŸ® LÃ³gica de Controle

```
ENTRADA: deviation (desvio em pixels)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ÃRVORE DE DECISÃƒO                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    deviation?
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
     < -150          -150 a 150       > 150
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ CURVA   â”‚    â”‚  RETO   â”‚    â”‚ CURVA   â”‚
   â”‚ BRUSCA  â”‚    â”‚  SUAVE  â”‚    â”‚ BRUSCA  â”‚
   â”‚ â—€â”€â”€â”€â”€   â”‚    â”‚  â”€â”€â–¶    â”‚    â”‚  â”€â”€â”€â”€â–¶  â”‚
   â”‚ESQUERDA â”‚    â”‚         â”‚    â”‚ DIREITA â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
   left: -15      left: 45*      left: 55
   right: 55      right: 45*     right: -15
                  (* ajustado
                   proporcionalmente)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CÃLCULO DE VELOCIDADE                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Curva Suave:
  normalized = deviation / 320  # -1 a 1
  
  Se deviation > 0 (linha Ã  direita):
    left_speed = BASE_SPEED
    right_speed = BASE_SPEED * (1 - |normalized| * 0.8)
  
  Se deviation < 0 (linha Ã  esquerda):
    left_speed = BASE_SPEED * (1 - |normalized| * 0.8)
    right_speed = BASE_SPEED

Curva Brusca:
  Se deviation > THRESHOLD:
    left_speed = TURN_SPEED
    right_speed = -TURN_SPEED * 0.3  # Inverte
```

## ğŸ”Œ Protocolo de ComunicaÃ§Ã£o

### WebSocket - Comandos

```json
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FORMATO DE COMANDO                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Comando BÃ¡sico:
{
  "action": "forward",    // forward, backward, left, right, stop
  "speed": 50             // 0-100
}

Comando Customizado (usado pelo algoritmo):
{
  "action": "custom",
  "left": 45,            // -100 a 100 (negativo = rÃ©)
  "right": 60            // -100 a 100
}

Resposta:
{
  "status": "ok"
}
```

### Fluxo WebSocket

```
PC                                    ESP32
â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€ HANDSHAKE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â”‚         (HTTP Upgrade)               â”‚
â”‚â—€â”€â”€â”€â”€â”€â”€ 101 Switching Protocols â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€ {"action": "custom", ...} â”€â”€â–¶â”‚
â”‚         (Frame WebSocket)            â”‚
â”‚                                      â”‚ Processa
â”‚                                      â”‚ Controla motores
â”‚                                      â”‚
â”‚â—€â”€â”€â”€â”€â”€â”€ {"status": "ok"} â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€ {"action": "stop"} â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
â”‚                                      â”‚
â”‚â—€â”€â”€â”€â”€â”€â”€ {"status": "ok"} â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
```

## ğŸ›ï¸ Controle de Motores (L298N)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DRIVER L298N                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ESP32                  L298N              Motores
  GPIO 25  â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ IN1 â”€â”€â”€â”€â”€â”
  GPIO 26  â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ IN2 â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â–¶ Motor Esquerdo
  GPIO 27  â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ENA â”€â”€â”€â”€â”€â”˜       (PWM controla velocidade)
                      (PWM)

  GPIO 32  â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ IN3 â”€â”€â”€â”€â”€â”
  GPIO 33  â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ IN4 â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â–¶ Motor Direito
  GPIO 14  â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ENB â”€â”€â”€â”€â”€â”˜
                      (PWM)

  GND      â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ GND
  5V       â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ 5V (lÃ³gica)

  [Bateria] â”€â”€â”€â”€â”€â”€â”€â”€â–¶ 12V (motores)
                      GND

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                TABELA DE DIREÃ‡ÃƒO                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IN1  IN2  ENA    â”‚  Resultado
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 1    0   PWM   â”‚  Frente (velocidade PWM)
 0    1   PWM   â”‚  RÃ© (velocidade PWM)
 0    0    x    â”‚  Parado (freio)
 1    1    x    â”‚  Parado (freio)
 x    x    0    â”‚  Desligado
```

## ğŸ“¸ Processamento de Imagem

```
FRAME ORIGINAL (640x480)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    â”‚
â”‚         [Ignora esta Ã¡rea]         â”‚
â”‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† ROI_Y (70% altura)
â”‚                                    â”‚
â”‚      [ROI - Processa aqui]         â”‚
â”‚            â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                  â”‚ â† Linha detectada
â”‚              â–ˆâ–ˆ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      â†“ cv2.cvtColor(BGR â†’ HSV)

FRAME HSV
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cada pixel tem: [H, S, V]          â”‚
â”‚ H: Matiz (cor)                     â”‚
â”‚ S: SaturaÃ§Ã£o                       â”‚
â”‚ V: Valor (brilho)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      â†“ cv2.inRange(lower_black, upper_black)

MÃSCARA BINÃRIA
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0   0   0   0   0   0   0   0      â”‚
â”‚ 0   0 255 255 255 0   0   0        â”‚ â† Branco = linha
â”‚ 0   0   0 255 0   0   0   0        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      â†“ cv2.findContours()

CONTORNOS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            â”Œâ”€â”€â”€â”                   â”‚
â”‚            â”‚ â–ˆ â”‚   â† Contorno      â”‚
â”‚            â””â”€â”¬â”€â”˜      detectado    â”‚
â”‚              â— â† Centro (cx, cy)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      â†“ Calcula desvio

DECISÃƒO
cx = 400, frame_center = 320
deviation = 400 - 320 = 80 pixels Ã  direita
â†’ Vira para a direita!
```

## ğŸ”§ Diagrama de Hardware

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CARRINHO COMPLETO                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    ESP32      â”‚
              â”‚  (CÃ©rebro)    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ Pinos GPIO
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                         â”‚
         â–¼                         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  L298N   â”‚              â”‚  L298N   â”‚
  â”‚ (Driver) â”‚              â”‚ (Driver) â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚                         â”‚
       â–¼                         â–¼
   âš™ï¸ Motor                  âš™ï¸ Motor
   Esquerdo                  Direito
       â”‚                         â”‚
       â–¼                         â–¼
    ğŸ”µ Roda                   ğŸ”µ Roda

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Bateria    â”‚ 7.4V-12V
         â”‚  (Energia)  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
         â–¼             â–¼
      ESP32         Motores
       5V            12V
```

## ğŸ“Š Timing Diagram

```
Tempo (ms)  â”‚  PC          â”‚  WebSocket  â”‚  ESP32       â”‚  Motores
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    0      â”‚ Captura      â”‚             â”‚              â”‚ Estado A
    10     â”‚ Processa     â”‚             â”‚              â”‚ Estado A
    20     â”‚ Calcula      â”‚             â”‚              â”‚ Estado A
    30     â”‚ Envia â”€â”€â”€â”€â”€â”€â–¶â”‚ Transmite â”€â–¶â”‚              â”‚ Estado A
    35     â”‚              â”‚             â”‚ Recebe       â”‚ Estado A
    40     â”‚              â”‚             â”‚ Processa     â”‚ Estado A
    45     â”‚              â”‚             â”‚ Atualiza PWM â”‚ Estado B
    50     â”‚ Captura      â”‚             â”‚              â”‚ Estado B
    60     â”‚ Processa     â”‚             â”‚              â”‚ Estado B
    ...    â”‚              â”‚             â”‚              â”‚

Intervalo entre comandos: ~50ms (20 comandos/segundo)
```

## ğŸ¯ Performance

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MÃ‰TRICAS TÃPICAS                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LatÃªncia Total: ~50-100ms
  â”œâ”€ Captura frame: 5-10ms
  â”œâ”€ Processamento OpenCV: 10-20ms
  â”œâ”€ TransmissÃ£o WebSocket: 5-15ms
  â”œâ”€ Processamento ESP32: 1-2ms
  â””â”€ AtualizaÃ§Ã£o motores: <1ms

Taxa de comandos: ~10-20 Hz
FPS da cÃ¢mera: 15-30 FPS
Velocidade mÃ¡xima: ~1-2 m/s
PrecisÃ£o: Â±2cm do centro da linha
```

---

**Este diagrama ajuda a entender como todos os componentes trabalham juntos! ğŸ¯**

